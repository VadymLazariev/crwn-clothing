{"ast":null,"code":"import _regeneratorRuntime from\"/home/vadym-lazariev/WebstormProjects/crwn-clothing/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _defineProperty from\"/home/vadym-lazariev/WebstormProjects/crwn-clothing/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";var _marked=/*#__PURE__*/_regeneratorRuntime.mark(getSnapshotFromUserAuth),_marked2=/*#__PURE__*/_regeneratorRuntime.mark(signInWithGoogle),_marked3=/*#__PURE__*/_regeneratorRuntime.mark(signInWithEmail),_marked4=/*#__PURE__*/_regeneratorRuntime.mark(isUserAuthenticated),_marked5=/*#__PURE__*/_regeneratorRuntime.mark(signOut),_marked6=/*#__PURE__*/_regeneratorRuntime.mark(signUp),_marked7=/*#__PURE__*/_regeneratorRuntime.mark(signInAfterSignUp),_marked8=/*#__PURE__*/_regeneratorRuntime.mark(onGoogleSignInStart),_marked9=/*#__PURE__*/_regeneratorRuntime.mark(onEmailSignInStart),_marked10=/*#__PURE__*/_regeneratorRuntime.mark(onCheckUserSession),_marked11=/*#__PURE__*/_regeneratorRuntime.mark(onSignOutStart),_marked12=/*#__PURE__*/_regeneratorRuntime.mark(onSignUpStart),_marked13=/*#__PURE__*/_regeneratorRuntime.mark(onSignUpSuccess),_marked14=/*#__PURE__*/_regeneratorRuntime.mark(userSagas);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(source,true).forEach(function(key){_defineProperty(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}import{takeLatest,put,all,call}from'redux-saga/effects';import UserActionTypes from\"./user.types\";import{auth,googleProvider,createUserProfileDocument,getCurrentUser}from\"../../firebase/firebase.utils\";import{signInSuccess,signInFailure,signOutSuccess,signOutFailure,signUpFailure,signUpSuccess}from\"./user.actions\";export function getSnapshotFromUserAuth(userAuth,additionalData){var userRef,userSnapshot;return _regeneratorRuntime.wrap(function getSnapshotFromUserAuth$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return call(createUserProfileDocument,userAuth,additionalData);case 3:userRef=_context.sent;_context.next=6;return userRef.get();case 6:userSnapshot=_context.sent;_context.next=9;return put(signInSuccess(_objectSpread({id:userSnapshot.id},userSnapshot.data())));case 9:_context.next=15;break;case 11:_context.prev=11;_context.t0=_context[\"catch\"](0);_context.next=15;return put(signInFailure(_context.t0));case 15:case\"end\":return _context.stop();}}},_marked,null,[[0,11]]);}function signInWithGoogle(){var _ref,user;return _regeneratorRuntime.wrap(function signInWithGoogle$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return auth.signInWithPopup(googleProvider);case 3:_ref=_context2.sent;user=_ref.user;_context2.next=7;return getSnapshotFromUserAuth(user);case 7:_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](0);_context2.next=13;return put(signInFailure(_context2.t0));case 13:case\"end\":return _context2.stop();}}},_marked2,null,[[0,9]]);}export function signInWithEmail(_ref2){var _ref2$payload,email,password,_ref3,user;return _regeneratorRuntime.wrap(function signInWithEmail$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_ref2$payload=_ref2.payload,email=_ref2$payload.email,password=_ref2$payload.password;_context3.prev=1;_context3.next=4;return auth.signInWithEmailAndPassword(email,password);case 4:_ref3=_context3.sent;user=_ref3.user;_context3.next=8;return getSnapshotFromUserAuth(user);case 8:_context3.next=13;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](1);put(signInFailure(_context3.t0));case 13:case\"end\":return _context3.stop();}}},_marked3,null,[[1,10]]);}export function isUserAuthenticated(){var userAuth;return _regeneratorRuntime.wrap(function isUserAuthenticated$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.prev=0;_context4.next=3;return getCurrentUser();case 3:userAuth=_context4.sent;if(userAuth){_context4.next=6;break;}return _context4.abrupt(\"return\");case 6:_context4.next=8;return getSnapshotFromUserAuth(userAuth);case 8:_context4.next=14;break;case 10:_context4.prev=10;_context4.t0=_context4[\"catch\"](0);_context4.next=14;return put(signInFailure(_context4.t0));case 14:case\"end\":return _context4.stop();}}},_marked4,null,[[0,10]]);}export function signOut(){return _regeneratorRuntime.wrap(function signOut$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.prev=0;_context5.next=3;return auth.signOut();case 3:_context5.next=5;return put(signOutSuccess());case 5:_context5.next=11;break;case 7:_context5.prev=7;_context5.t0=_context5[\"catch\"](0);_context5.next=11;return put(signOutFailure(_context5.t0));case 11:case\"end\":return _context5.stop();}}},_marked5,null,[[0,7]]);}export function signUp(_ref4){var _ref4$payload,email,password,displayName,_ref5,user;return _regeneratorRuntime.wrap(function signUp$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_ref4$payload=_ref4.payload,email=_ref4$payload.email,password=_ref4$payload.password,displayName=_ref4$payload.displayName;_context6.prev=1;_context6.next=4;return auth.createUserWithEmailAndPassword(email,password);case 4:_ref5=_context6.sent;user=_ref5.user;_context6.next=8;return put(signUpSuccess({user:user,additionalData:{displayName:displayName}}));case 8:_context6.next=14;break;case 10:_context6.prev=10;_context6.t0=_context6[\"catch\"](1);_context6.next=14;return put(signUpFailure());case 14:case\"end\":return _context6.stop();}}},_marked6,null,[[1,10]]);}export function signInAfterSignUp(_ref6){var _ref6$payload,user,additionalData;return _regeneratorRuntime.wrap(function signInAfterSignUp$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_ref6$payload=_ref6.payload,user=_ref6$payload.user,additionalData=_ref6$payload.additionalData;_context7.next=3;return getSnapshotFromUserAuth(user,additionalData);case 3:case\"end\":return _context7.stop();}}},_marked7);}export function onGoogleSignInStart(){return _regeneratorRuntime.wrap(function onGoogleSignInStart$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return takeLatest(UserActionTypes.GOOGLE_SIGN_IN_START,signInWithGoogle);case 2:case\"end\":return _context8.stop();}}},_marked8);}export function onEmailSignInStart(){return _regeneratorRuntime.wrap(function onEmailSignInStart$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return takeLatest(UserActionTypes.EMAIL_SIGN_IN_START,signInWithEmail);case 2:case\"end\":return _context9.stop();}}},_marked9);}export function onCheckUserSession(){return _regeneratorRuntime.wrap(function onCheckUserSession$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return takeLatest(UserActionTypes.CHECK_USER_SESSION,isUserAuthenticated);case 2:case\"end\":return _context10.stop();}}},_marked10);}export function onSignOutStart(){return _regeneratorRuntime.wrap(function onSignOutStart$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return takeLatest(UserActionTypes.SIGN_OUT_START,signOut);case 2:case\"end\":return _context11.stop();}}},_marked11);}export function onSignUpStart(){return _regeneratorRuntime.wrap(function onSignUpStart$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:_context12.next=2;return takeLatest(UserActionTypes.SIGN_UP_START,signUp);case 2:case\"end\":return _context12.stop();}}},_marked12);}export function onSignUpSuccess(){return _regeneratorRuntime.wrap(function onSignUpSuccess$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:_context13.next=2;return takeLatest(UserActionTypes.SIGN_UP_SUCCESS,signInAfterSignUp);case 2:case\"end\":return _context13.stop();}}},_marked13);}export function userSagas(){return _regeneratorRuntime.wrap(function userSagas$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.next=2;return all([call(onGoogleSignInStart),call(onEmailSignInStart),call(onCheckUserSession),call(onSignOutStart),call(onSignUpStart),call(onSignUpSuccess)]);case 2:case\"end\":return _context14.stop();}}},_marked14);}","map":{"version":3,"sources":["/home/vadym-lazariev/WebstormProjects/crwn-clothing/client/src/redux/user/user.sagas.js"],"names":["getSnapshotFromUserAuth","signInWithGoogle","signInWithEmail","isUserAuthenticated","signOut","signUp","signInAfterSignUp","onGoogleSignInStart","onEmailSignInStart","onCheckUserSession","onSignOutStart","onSignUpStart","onSignUpSuccess","userSagas","takeLatest","put","all","call","UserActionTypes","auth","googleProvider","createUserProfileDocument","getCurrentUser","signInSuccess","signInFailure","signOutSuccess","signOutFailure","signUpFailure","signUpSuccess","userAuth","additionalData","userRef","get","userSnapshot","id","data","signInWithPopup","user","payload","email","password","signInWithEmailAndPassword","displayName","createUserWithEmailAndPassword","GOOGLE_SIGN_IN_START","EMAIL_SIGN_IN_START","CHECK_USER_SESSION","SIGN_OUT_START","SIGN_UP_START","SIGN_UP_SUCCESS"],"mappings":"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","sourcesContent":["import { takeLatest, put, all, call } from 'redux-saga/effects';\n\nimport UserActionTypes from \"./user.types\";\n\nimport { auth, googleProvider, createUserProfileDocument, getCurrentUser} from \"../../firebase/firebase.utils\";\n\nimport {\n  signInSuccess,\n  signInFailure,\n  signOutSuccess,\n  signOutFailure,\n  signUpFailure,\n  signUpSuccess\n} from \"./user.actions\";\n\nexport function* getSnapshotFromUserAuth (userAuth, additionalData) {\n  try {\n    const userRef = yield call(createUserProfileDocument, userAuth, additionalData);\n    const userSnapshot = yield userRef.get();\n    yield put(signInSuccess( {id: userSnapshot.id, ...userSnapshot.data()}));\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\n\nfunction* signInWithGoogle() {\n  try {\n    const { user } = yield auth.signInWithPopup(googleProvider);\n    yield getSnapshotFromUserAuth(user);\n  } catch (error) {\n    yield put(signInFailure(error));\n  }\n}\n\nexport function* signInWithEmail({payload: { email, password }}) {\n  try {\n    const { user } = yield auth.signInWithEmailAndPassword(email, password);\n    yield getSnapshotFromUserAuth(user);\n  } catch (error) {\n    put(signInFailure(error));\n  }\n}\n\nexport function* isUserAuthenticated() {\n  try {\n    const userAuth = yield getCurrentUser();\n    if (!userAuth) return;\n    yield getSnapshotFromUserAuth(userAuth);\n  } catch (error) {\n    yield put(signInFailure(error))\n  }\n}\n\nexport function* signOut() {\n  try {\n    yield auth.signOut();\n    yield put(signOutSuccess());\n  } catch (error) {\n    yield put(signOutFailure(error));\n  }\n}\n\nexport function* signUp({ payload: {email, password, displayName }}) {\n  try {\n    const { user } = yield auth.createUserWithEmailAndPassword(email, password);\n    yield put(signUpSuccess({user, additionalData: {displayName}}));\n  } catch (error) {\n    yield put(signUpFailure())\n  }\n}\n\nexport function* signInAfterSignUp({payload: {user, additionalData}}) {\n  yield getSnapshotFromUserAuth(user, additionalData);\n}\n\nexport function* onGoogleSignInStart() {\n  yield takeLatest(UserActionTypes.GOOGLE_SIGN_IN_START, signInWithGoogle);\n}\n\nexport function* onEmailSignInStart() {\n  yield takeLatest(UserActionTypes.EMAIL_SIGN_IN_START, signInWithEmail);\n}\n\nexport function* onCheckUserSession() {\n  yield takeLatest(UserActionTypes.CHECK_USER_SESSION, isUserAuthenticated)\n}\n\nexport function* onSignOutStart() {\n  yield takeLatest(UserActionTypes.SIGN_OUT_START, signOut);\n}\n\nexport function* onSignUpStart() {\n  yield takeLatest(UserActionTypes.SIGN_UP_START, signUp)\n}\n\nexport function* onSignUpSuccess() {\n  yield takeLatest(UserActionTypes.SIGN_UP_SUCCESS, signInAfterSignUp)\n}\n\nexport function* userSagas() {\n  yield all([\n    call(onGoogleSignInStart),\n    call(onEmailSignInStart),\n    call(onCheckUserSession),\n    call(onSignOutStart),\n    call(onSignUpStart),\n    call(onSignUpSuccess)\n    ],\n  );\n}\n"]},"metadata":{},"sourceType":"module"}